import chalk from "chalk";

import { BaseCommand } from "../baseCommand.js";

export default class HashCommand extends BaseCommand<typeof HashCommand> {
    static summary = "Prints out image hash generated by the build command";

    static description =
        "Converts the binary generated by the build command to hexadecimal and prints out the result to console";

    public static enableJsonFlag = true;

    public async run() {
        const hash = this.getMachineHash();
        if (hash) {
            if (!this.jsonEnabled()) {
                process.stdout.write(
                    `${chalk.green("?")} Cartesi machine templateHash ${chalk.cyan(hash)}\n`,
                );
            } else {
                return { hash };
            }
        } else {
            this.error(
                "Cartesi machine snapshot not found, run 'sunodo build'",
            );
        }
    }
}
